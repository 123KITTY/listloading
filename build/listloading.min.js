(function(){var publishEvents=(function(){var listen,log,obj,one,remove,trigger,__this;obj={};__this=this;listen=function(key,eventfn){var stack,_ref;stack=(_ref=obj[key])!=null?_ref:obj[key]=[];return stack.push(eventfn)};one=function(key,eventfn){remove(key);return listen(key,eventfn)};remove=function(key){var _ref;return(_ref=obj[key])!=null?_ref.length=0:void 0};trigger=function(){var fn,stack,_i,_len,_ref,key;key=Array.prototype.shift.call(arguments);stack=(_ref=obj[key])!=null?_ref:obj[key]=[];for(_i=0,_len=stack.length;_i<_len;_i++){fn=stack[_i];if(fn==undefined){return false}if(fn.apply(__this,arguments)===false){return false}}};return{listen:listen,one:one,remove:remove,trigger:trigger}})();function timeDifference(publishTime){var nowTime=Date.parse(new Date());var d=(nowTime-publishTime)/1000;var d_days=parseInt(d/86400);var d_hours=parseInt(d/3600);var d_minutes=parseInt(d/60);var d_seconds=parseInt(d);if(d_days>0&&d_days<4){return d_days+"天前"}else{if(d_days<=0&&d_hours>0){return d_hours+"小时前"}else{if(d_hours<=0&&d_minutes>0){return d_minutes+"分钟前"}else{if(d_minutes<=0&&d_seconds>=0){return"刚刚之前"}else{var s=new Date(publishTime);return s.getFullYear()+"年"+(s.getMonth()+1)+"月"+s.getDate()+"日 "+s.getHours()+":"+":"+s.getMinutes()+":"+s.getSeconds()}}}}}$.fn.listloading=function(options){return new ListLoading(this,options)};function ListLoading(element,options){this.ele=$(element);this.id=$(element).attr("id");this.children=$($(element).get(0).children[0]);this.pullUpId="pullUp-"+this.id;this.pullDownId="pullDown-"+this.id;this.init(options)}ListLoading.prototype={version:"1.0.0",init:function(options){this.options={};this.options.upLoadmoretxt='<i class="icon-up"></i>上拉加载更多';this.options.pullDrefreshtxt='<i class="icon-down"></i>下拉加载更多';this.options.loadertxt='<i class="icon-loading"></i>正在加载更多';this.options.Realtimetxt="松开刷新";this.options.loaderendtxt="已显示完全部";this.options.windowHeight=$(window).height();this.options.windowWidth=$(window).width();this.options.viewHeight=this.ele.height();this.options.pullUpActionStr="pullUpActionStr"+this.id;this.options.pullDownActionStr="pullDownAction"+this.id;publishEvents.remove(this.options.pullUpActionStr);publishEvents.remove(this.options.pullDownActionStr);$.extend(this.options,options);this.render()},render:function(){this.pullDownAction()},destroy:function(){$(this.children).css({"-webkit-transform":"","transform":""});$("#"+this.pullDownId+", #"+this.pullUpId).remove();this.iscroll.destroy()},refresh:function(refresh){this.createPullUpEle(refresh)},createPullUpEle:function(refresh){var op=this.options;var children=this.children;children.css("min-height","auto");var childrenHeight=children.height();var pullUpId=this.pullUpId;var viewHeight=op.viewHeight;var pullDownOffset=op.pullDownOffset;var iscroll=this.iscroll;op.minScrollHeight=viewHeight+pullDownOffset;if(this.pullUpEle){if(childrenHeight<op.minScrollHeight){this.pullUpEle.remove();this.pullUpEle=null;this.options.pullUpOffset=0;children.css("min-height",op.minScrollHeight)}}else{if($.isFunction(op.pullUpAction)&&childrenHeight>op.minScrollHeight){var html='<div id="'+pullUpId+'" data-class="pullUpId">'+'<span class="pullUpLabel inlineblock-span">'+op.upLoadmoretxt+"</span></div>";children.append(html);this.pullUpEle=$("#"+pullUpId);op.pullUpOffset=this.pullUpEle.get(0).offsetHeight}else{children.css("min-height",op.minScrollHeight)}}if(iscroll){if(this.pullUpEle&&!refresh){this.pullUpEle.height(0)}iscroll.refresh();if(this.pullUpEle&&!refresh){this.pullUpEle.removeAttr("style");iscroll.maxScrollY=iscroll.maxScrollY-this.options.pullUpOffset}if(iscroll.y===0&&!refresh){this.resizeAnimate()}}},createPullIScroll:function(){var op=this.options;var timeHtml="";if(op.disableTime){op.endDate=Date.parse(new Date());timeHtml='<span class="time">最后更新时间：<em id="'+this.id+'time-em">'+timeDifference(op.endDate)+"</em></span>"}var pullDownEle=$('<div id="'+this.pullDownId+'" data-class="pullDownId">'+'	<span class="pullDownLabel inlineblock-span">'+op.pullDrefreshtxt+"</span>"+timeHtml+"</div>");pullDownEle.prependTo(this.children);this.pullDownEle=pullDownEle;this.options.pullDownOffset=pullDownEle.get(0)?pullDownEle.get(0).offsetHeight:0;this.createPullUpEle()},toggleClassText:function(obj,cls,labelCls,text){obj.attr("class",cls).find("."+labelCls).html(text)},resizeAnimate:function(y){var iscroll=this.iscroll;var pullDownOffset=this.options.pullDownOffset;if(!y){y=-pullDownOffset}else{var maxScrollY=-iscroll.maxScrollY-pullDownOffset;if(-y<=maxScrollY){y=-maxScrollY}}iscroll.scrollTo(0,y,300,IScroll.utils.ease.quadratic)},scrollEvent:function(){var self=this;var op=this.options;var iscroll=this.iscroll;var pullUpId=this.pullUpId;var pullDownEle=this.pullDownEle;var toggleClassText=this.toggleClassText;var pullDrefreshtxt=op.pullDrefreshtxt;var upLoadmoretxt=op.upLoadmoretxt;var Realtimetxt=op.Realtimetxt;var loadertxt=op.loadertxt;var pullDownOffset=-op.pullDownOffset;iscroll.on("scrollStart",function(){var pullUpEle=self.pullUpEle;
self.startPullTime=new Date().getTime();if(op.disableTime){$("#"+self.id+"time-em").html(timeDifference(op.endDate))}if(pullDownEle&&pullDownEle.hasClass("loading")){toggleClassText(pullDownEle,"","pullDownLabel",pullDrefreshtxt)}else{if(pullUpEle&&pullUpEle.hasClass("loading")){toggleClassText(pullUpEle,"","pullUpLabel",upLoadmoretxt)}}});iscroll.on("scrollMove",function(){var y=this.y;var maxScrollY=this.maxScrollY;var pullUpEle=self.pullUpEle;var gapY=5;var pullDownEleCls=pullDownEle.hasClass("flip");var pullUpEleCls=pullUpEle&&pullUpEle.hasClass("flip");if(y>gapY&&!pullDownEleCls){toggleClassText(pullDownEle,"flip","pullDownLabel",'<i class="icon-up"></i>'+Realtimetxt)}else{if(y<gapY&&pullDownEleCls){toggleClassText(pullDownEle,"","pullDownLabel",pullDrefreshtxt)}else{if(pullUpEle&&y<(maxScrollY-gapY)&&!pullUpEleCls){toggleClassText(pullUpEle,"flip","pullUpLabel",'<i class="icon-down"></i>'+Realtimetxt)}else{if(pullUpEle&&y>(maxScrollY+gapY)&&pullUpEleCls){toggleClassText(pullUpEle,"","pullUpLabel",upLoadmoretxt)}}}}});iscroll.on("scrollEnd",function(){var y=this.y;var maxScrollY=this.maxScrollY;var pullUpEle=self.pullUpEle;var nowDate=new Date();if(y===maxScrollY&&pullUpEle){toggleClassText(pullUpEle,"flip","pullUpLabel",Realtimetxt)}self.endPullTime=nowDate.getTime();self.totalGapTime=self.endPullTime-self.startPullTime;self.options.endDate=Date.parse(nowDate);if(self.totalGapTime<200){if(y>pullDownOffset&&y<1){self.resizeAnimate()}return}if(pullDownEle&&pullDownEle.hasClass("flip")){toggleClassText(pullDownEle,"loading","pullDownLabel",loadertxt);self.pullDownAction()}else{if(pullUpEle&&pullUpEle.hasClass("flip")){toggleClassText(pullUpEle,"loading","pullUpLabel",loadertxt);self.pullUpAction()}else{if(y>pullDownOffset&&y<1){self.resizeAnimate()}else{if(-maxScrollY>=-y&&(maxScrollY+op.pullUpOffset)>y){self.resizeAnimate(maxScrollY+op.pullUpOffset)}}}}})},pullDownAction:function(){var intervals=new Date().getTime()-this.startPullTime;var self=this;var op=this.options;var pullDownAction=op.pullDownAction;var pullDownActionStr=op.pullDownActionStr;if($.isFunction(pullDownAction)){if(!this.iscroll){publishEvents.listen(pullDownActionStr,function(){self.createPullIScroll();var obj={startY:-op.pullDownOffset,listLoading:true,};$.extend(obj,op.iscrollOptions);self.iscroll=new IScroll("#"+self.id,obj);self.scrollEvent();publishEvents.remove(pullDownActionStr)});pullDownAction(function(){publishEvents.trigger(pullDownActionStr)})}if(intervals>=400){publishEvents.listen(pullDownActionStr,function(){self.refresh(true);var pullUpEle=self.pullUpEle;if(pullUpEle){pullUpEle.find(".pullUpLabel").html(op.upLoadmoretxt)}else{self.createPullUpEle()}self.resizeAnimate();self.iscroll.refresh();publishEvents.remove(pullDownActionStr)});pullDownAction(function(){publishEvents.trigger(pullDownActionStr)})}}},pullUpAction:function(){var intervals=new Date().getTime()-this.startPullTime;var self=this;var op=this.options;var pullUpAction=op.pullUpAction;var pullUpActionStr=op.pullUpActionStr;var iscroll=self.iscroll;if($.isFunction(pullUpAction)){var top=iscroll.y+op.pullUpOffset;if(intervals>=400){publishEvents.listen(pullUpActionStr,function(){self.refresh(true);var pullUpEle=self.pullUpEle;var loaderText=op.loaderendtxt;if(op.pullEnd){self.resizeAnimate(top)}else{loaderText=op.upLoadmoretxt;iscroll.refresh()}pullUpEle.find(".pullUpLabel").html(loaderText);publishEvents.remove(pullUpActionStr)});pullUpAction(function(pullEnd){op.pullEnd=pullEnd;publishEvents.trigger(pullUpActionStr)})}else{self.resizeAnimate(top)}}},evt:function Events(element,type,eventHandle,flg){var touchable="ontouchstart" in window;var clickEvent=touchable?"touchstart":"click",mouseDownEvent=touchable?"touchstart":"mousedown",mouseUpEvent=touchable?"touchend":"mouseup",mouseMoveEvent=touchable?"touchmove":"mousemove",mouseMoveOutEvent=touchable?"touchleave":"mouseout";var _returnData=function(evt){var neweEvt={};var cev=evt.originalEvent;if(cev==undefined){cev=evt}if(cev.changedTouches){neweEvt.pageX=cev.changedTouches[0].pageX;neweEvt.pageY=cev.changedTouches[0].pageY;neweEvt.clientX=cev.changedTouches[0].clientX;neweEvt.clientY=cev.changedTouches[0].clientY}else{neweEvt.pageX=evt.pageX;neweEvt.pageY=evt.pageY;neweEvt.clientX=evt.clientX;neweEvt.clientY=evt.clientY}neweEvt.evt=evt;return neweEvt};var getTouchPos=function(e){return{x:e.clientX,y:e.clientY}};var getDist=function(p1,p2){if(!p1||!p2){return 0}return Math.sqrt((p1.x-p2.x)*(p1.x-p2.x)+(p1.y-p2.y)*(p1.y-p2.y))};var _onClick=function(dom,evt,callback){var neweEvt=_returnData(evt);callback(dom,neweEvt)};var _onClickDown=function(dom,evt,callback){var neweEvt=_returnData(evt);callback(dom,neweEvt)};var _onClickUp=function(dom,evt,callback){var neweEvt=_returnData(evt);callback(dom,neweEvt)};var _onMove=function(dom,evt,callback){var neweEvt=_returnData(evt);callback(dom,neweEvt)};var _onOut=function(evt,callback){var neweEvt=_returnData(evt);callback(dom,neweEvt)};var rootEle=this.ele;if(flg==undefined){flg=true
}switch(type){case"mousemove":case"touchmove":if(flg){rootEle.off(mouseMoveEvent,element)}rootEle.on(mouseMoveEvent,element,function(e){_onMove($(this),e,eventHandle)});break;case"click":case"tap":var TAP_DISTANCE=20;var pt_pos;var ct_pos;var startEvtHandler=function(e){var ev=_returnData(e);ct_pos=getTouchPos(ev)};var endEvtHandler=function(dom_,e,fn){var ev=_returnData(e);var now=Date.now();var pt_pos=getTouchPos(ev);var dist=getDist(ct_pos,pt_pos);if(dist<TAP_DISTANCE){_onClick(dom_,e,eventHandle)}};if(flg){rootEle.off(mouseDownEvent,element);rootEle.off(mouseUpEvent,element)}rootEle.on(mouseDownEvent,element,function(e){if(e.button!=2){startEvtHandler(e)}});rootEle.on(mouseUpEvent,element,function(e){if(e.button!=2){var $this=$(this);endEvtHandler($this,e,eventHandle)}});break;case"mousedown":case"touchstart":if(flg){rootEle.off(mouseDownEvent,element)}rootEle.on(mouseDownEvent,element,function(e){_onClickDown($(this),e,eventHandle)});break;case"mouseup":case"touchend":if(flg){rootEle.off(mouseUpEvent,element)}rootEle.on(mouseUpEvent,element,function(e){_onClickUp($(this),e,eventHandle)});break;case"mouseout":if(flg){rootEle.off(mouseMoveOutEvent,element)}rootEle.on(mouseMoveOutEvent,element,function(e){endEvtHandler(e,eventHandle)});break}}}})(window.Zepto||window.jQuery);